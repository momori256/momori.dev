<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>『Real World OCaml』で入門レベルを脱する | Momori Nakano</title>
<meta name="keywords" content="ocaml">
<meta name="description" content="本書は OCaml のベテランプログラマ 2 名による解説本です. 第 2 版が 2021 年にかかれていて, ネットで無料公開されています.
全 3 章は以下のような構成で, OCaml 初心者でも読めますし, 深堀りされた解説からは経験者でも得るものがありそうです.
OCaml の機能一通り (基礎文法, ヴァリアント, レコード, ファンクター, GADT, Class など) 具体例 (コマンドラインの引数パーズ, 非同期通信, json パーザ) OCaml のランタイムとコンパイラの仕組み 個人的にここ数か月 OCaml に興味を持って少しずつ触れてきたのですが, 入門の次に進むための知識が得たいと思い本書を読みました. 知りたかったことは例えば以下のような点です.
標準ライブラリにはそれほど機能が揃っていないが, 便利なライブラリがあるのか (または自分でライブラリを整備するのが普通なのか) プロジェクトをどのようにファイル構成するか どの程度の規模でモジュールを分けるか テストはどうやって書くか こういった事柄はやや抽象的でそのものズバリ検索するのが難しいと思っていますが, 本書には知りたかったことは全て書いてありました. そのくらい網羅的で, もちろん知らなかったこと (知りたいとすら思わなかったこと) も満載でした.
高度な機能や具体的なライブラリの使い方などは読んでもピンとこなかったり軽く読み飛ばしたりした箇所があるのですが, 今後必要になったときに改めて読み返そうと思うような内容でした.
Base と Jane Street 本書では一貫して Base というライブラリが使われています. Base は OCaml の標準ライブラリを置き換えるべく作られたライブラリで, 今やデファクトスタンダードとなっている (らしい. 少なくとも私はそのような印象を受けた)OSS です.
メインの開発元は Jane Street という企業です.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/real-world-ocaml/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.364d6b9256fe5f2d0b7be3f86155a0ceaa731e7ce41aaee3cb04a613cd629a45.css" integrity="sha256-Nk1rklb&#43;Xy0Le&#43;P4YVWgzqpzHnzkGq7jywSmE81imkU=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/real-world-ocaml/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Momori Nakano (Alt + H)">Momori Nakano</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archive/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      『Real World OCaml』で入門レベルを脱する
    </h1>
    <div class="post-meta"><span title='2021-12-29 00:00:00 +0000 UTC'>December 29, 2021</span>&nbsp;·&nbsp;5 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#base-と-jane-street">Base と Jane Street</a></li>
    <li><a href="#すべてがリストだとこんなにも便利">すべてがリストだとこんなにも便利</a></li>
    <li><a href="#ocaml-のエコシステム">OCaml のエコシステム</a></li>
    <li><a href="#凄そうだけどピンとこない機能">凄そうだけどピンとこない機能</a></li>
    <li><a href="#実践ワークショップ">実践ワークショップ</a></li>
    <li><a href="#結び-ocaml-の何に魅力を感じるか">結び: OCaml の何に魅力を感じるか</a></li>
    <li><a href="#base-と-jane-street-1">Base と Jane Street</a></li>
    <li><a href="#すべてがリストだとこんなにも便利-1">すべてがリストだとこんなにも便利</a></li>
    <li><a href="#ocaml-のエコシステム-1">OCaml のエコシステム</a></li>
    <li><a href="#凄そうだけどピンとこない機能-1">凄そうだけどピンとこない機能</a></li>
    <li><a href="#実践ワークショップ-1">実践ワークショップ</a></li>
    <li><a href="#結び-ocaml-の何に魅力を感じるか-1">結び: OCaml の何に魅力を感じるか</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>本書は OCaml のベテランプログラマ 2 名による解説本です. 第 2 版が 2021 年にかかれていて, <a href="https://dev.realworldocaml.org/index.html">ネットで無料公開されています</a>.<br>
全 3 章は以下のような構成で, OCaml 初心者でも読めますし, 深堀りされた解説からは経験者でも得るものがありそうです.</p>
<ol>
<li>OCaml の機能一通り (基礎文法, ヴァリアント, レコード, ファンクター, GADT, Class など)</li>
<li>具体例 (コマンドラインの引数パーズ, 非同期通信, json パーザ)</li>
<li>OCaml のランタイムとコンパイラの仕組み</li>
</ol>
<p>個人的にここ数か月 OCaml に興味を持って少しずつ触れてきたのですが, 入門の次に進むための知識が得たいと思い本書を読みました. 知りたかったことは例えば以下のような点です.</p>
<ul>
<li>標準ライブラリにはそれほど機能が揃っていないが, 便利なライブラリがあるのか (または自分でライブラリを整備するのが普通なのか)</li>
<li>プロジェクトをどのようにファイル構成するか</li>
<li>どの程度の規模でモジュールを分けるか</li>
<li>テストはどうやって書くか</li>
</ul>
<p>こういった事柄はやや抽象的でそのものズバリ検索するのが難しいと思っていますが, 本書には知りたかったことは全て書いてありました. そのくらい網羅的で, もちろん知らなかったこと (知りたいとすら思わなかったこと) も満載でした.<br>
高度な機能や具体的なライブラリの使い方などは読んでもピンとこなかったり軽く読み飛ばしたりした箇所があるのですが, 今後必要になったときに改めて読み返そうと思うような内容でした.</p>
<h2 id="base-と-jane-street">Base と Jane Street<a hidden class="anchor" aria-hidden="true" href="#base-と-jane-street">#</a></h2>
<p>本書では一貫して <a href="https://github.com/janestreet/base">Base</a> というライブラリが使われています. Base は OCaml の標準ライブラリを置き換えるべく作られたライブラリで, 今やデファクトスタンダードとなっている (らしい. 少なくとも私はそのような印象を受けた)OSS です.</p>
<p>メインの開発元は <a href="https://www.janestreet.com">Jane Street</a> という企業です. OCaml 界隈では存在感のある会社で, 株やオプションなどの取引市場を提供する金融×Tech の会社です. 複雑な金融商品を取り扱うためにテクノロジーに注力していて, その競争力の源泉となっているのが OCaml だということのようです. おそらく OCaml を使っている会社としては最も有名だと思います.</p>
<p>標準ではないライブラリに常に依存するのは若干抵抗がありますが, 非常に便利なので使えるなら使ったほうが良いと思います.<br>
とはいえ, 実際にどの程度使われているのかはちゃんと調べていません. 歴戦の OCaml プログラマーは自作のライブラリを持っていると思うので, 不要だったりするのかもしれません.</p>
<h2 id="すべてがリストだとこんなにも便利">すべてがリストだとこんなにも便利<a hidden class="anchor" aria-hidden="true" href="#すべてがリストだとこんなにも便利">#</a></h2>
<p>本書で得た知識の中でも, 知っているのといないのとでは大違いだと思ったものにパイプ演算子 <code>|&gt;</code> があります. 演算子の定義は以下の通りです.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> <span style="color:#99d1db;font-weight:bold">(|&gt;)</span> x f <span style="color:#99d1db;font-weight:bold">=</span> f x
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>引数 関数</code> の順番を入れ替えて <code>関数 引数</code> とする演算子です. つまり, 以下の 2 つが同じになります.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> m1 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">;</span> 2<span style="color:#99d1db;font-weight:bold">;</span> 3<span style="color:#99d1db;font-weight:bold">]</span> <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">*</span> 2<span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#737994;font-style:italic">(* [2; 4; 6] *)</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> m2 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">;</span> 2<span style="color:#99d1db;font-weight:bold">;</span> 3<span style="color:#99d1db;font-weight:bold">]</span> <span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">*</span> 2<span style="color:#99d1db;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>これだけだと一体なんの役に立つのかさっぱりですが, 例を見ると納得です. 0-99 の中から, 13 の倍数を抽出し, 7 で割ったあまりが大きい順に表示する例です (この例自体には特に意味はありません).</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">open</span> <span style="color:#e5c890">Base</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ef9f76">List</span>.range 0 100
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.filter <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 13 <span style="color:#99d1db;font-weight:bold">=</span> 0<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 7<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.sort <span style="color:#99d1db;font-weight:bold">~</span>compare<span style="color:#99d1db;font-weight:bold">:</span><span style="color:#ef9f76">Int</span>.compare
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.rev <span style="color:#737994;font-style:italic">(* = reverse *)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>この例のように, リストに対する処理をパイプで連鎖させることができます. ネストが深くならないので見やすいですし, あとから行やコメントを追加することも容易いです.<br>
もし同じことをパイプ演算子なしでやると, 以下のようになります. あまりにも見辛いです.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ef9f76">List</span>.rev
</span></span><span style="display:flex;"><span>  <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.sort <span style="color:#99d1db;font-weight:bold">~</span>compare<span style="color:#99d1db;font-weight:bold">:</span><span style="color:#ef9f76">Int</span>.compare
</span></span><span style="display:flex;"><span>     <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.map
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 7<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.filter <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 13 <span style="color:#99d1db;font-weight:bold">=</span> 0<span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.range 0 100<span style="color:#99d1db;font-weight:bold">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>このパイプ演算子は Unix のパイプ (テキストを連鎖させる) や C# の Linq(IEnumerable を連鎖させる) と似ていると感じます. データ構造を統一するとこういう利点があると気付かされました.</p>
<h2 id="ocaml-のエコシステム">OCaml のエコシステム<a hidden class="anchor" aria-hidden="true" href="#ocaml-のエコシステム">#</a></h2>
<p>dune というビルドシステム (Rust の Cargo のようなもの. C/C++ の make の強化版), opam というパッケージマネージャ (gem, pip, npm のようなもの) があります.<br>
モダンな言語には標準装備されているような気がしますが, やはりあると安心です.</p>
<p>ちなみに dune の設定ファイルには S 式を使います. さらに, デバッグなどのシリアライズ用にも S 式を使います.<br>
json や XML ではなくて S 式を使うのは関数型っぽくて良いと思います. S 式は関数型世界の共通言語なのでしょうか.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">-</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#ef9f76">Sexp</span>.t <span style="color:#99d1db;font-weight:bold">=</span> 5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">-</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e78284">string</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;(1 2 3)&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="凄そうだけどピンとこない機能">凄そうだけどピンとこない機能<a hidden class="anchor" aria-hidden="true" href="#凄そうだけどピンとこない機能">#</a></h2>
<p>モジュール (Module) という便利な機能があります. これは, ある程度のコードをひとまとめにしてインターフェイスを定義できるもので, C++ だと Class のようなものです.</p>
<p>ファンクター(Functor) という, モジュールを引数にとってモジュールを返す関数のような機能があります. ごく簡単な例として, モジュールが持つ変数 x に 1 を足したモジュールを返すファンクターが紹介されています.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Increment</span> <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#e5c890">M</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e5c890">X_int</span><span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e5c890">X_int</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">struct</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">let</span> x <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">M</span>.x <span style="color:#99d1db;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Three</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">struct</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">let</span> x <span style="color:#99d1db;font-weight:bold">=</span> 3
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Four</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e5c890">Incremnt</span><span style="color:#99d1db;font-weight:bold">(</span><span style="color:#e5c890">Three</span><span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#737994;font-style:italic">(* Four.x = 4 *)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>これは, 私にとって馴染みある C++ などの言語には相当するものがない機能だと思います. 強いて言うなら継承が近いでしょうか.<br>
その他に, 端点を表すモジュールを引数にとって区間を扱うモジュールを返す例が紹介されています. これは確かに凄いですが, しかし他の使いみちをパッと思い浮かびません.</p>
<p>今まで触れたことがない概念であり, 抽象度も一段高いので理解しづらいのかなと思います. 読むだけだとピンとこないので, 実際にコードを色々書いてみて必要になったときに初めて理解できそうな気がします.<br>
その他に, エラーハンドリングや Core.Async の非同期処理など, 読んですぐにはピンとこないものの必要になったときに再度参照したい項目がありました.</p>
<h2 id="実践ワークショップ">実践ワークショップ<a hidden class="anchor" aria-hidden="true" href="#実践ワークショップ">#</a></h2>
<p>本書とは別のものですが, Jane Street が提供している <a href="https://github.com/janestreet/learn-ocaml-workshop">learn-ocaml-workshop</a> というリポジトリがあります. OCaml の基礎文法を一通りテストできる演習問題がまとまっていておすすめです.</p>
<p>練習の一環としてスネークゲームを実装する課題がありました. 穴埋め形式でコードを書いてテストを通せば良いので取り組みやすかったのですが, ちゃんと分かった気がしなかったので, 改めて <a href="https://github.com/momorin256/rattlesnake">自作しました</a>.<br>
なるべく依存が少なくなるようにして, 端末で動くシンプルなものを作りました. 実装にあたって curses/ncurses の OCaml バインディング <a href="https://github.com/mbacarella/curses">curses</a> を使わせていただきました.<br>
スネークゲームのロジック自体はそこまで複雑ではありませんが, Core.Unix から低レベルな API を使った non-blocking キー入力や, Curses で未実装だった cbreak, noecho の実装が個人的な見どころです.</p>
<h2 id="結び-ocaml-の何に魅力を感じるか">結び: OCaml の何に魅力を感じるか<a hidden class="anchor" aria-hidden="true" href="#結び-ocaml-の何に魅力を感じるか">#</a></h2>
<p>正直なところ本書の内容を理解しきれておらず, 紹介できていない内容が多数あります (GADT など&hellip;). これらは今後 OCaml を使い続けていくうちに, いつか分かるときが来ると思っています. 再読して理解が深まったら加筆するかもしれません.</p>
<p>改めて, 何が面白くて OCaml に触れているのか考えてみると, C++ にはない概念や機能があるということが大きいと思います.</p>
<ul>
<li>ファンクター, ヴァリアントなどは C++ にはない</li>
<li>基本的にすべて immutable(C++ でもどうせほとんどの変数には const をつけるので, デフォルトが immutable な方が好き)</li>
<li>List が主要なデータ構造で, List を使った処理が上手く書ける</li>
<li>強力なパターンマッチ</li>
<li>モジュールに型を定義して, 型の実装を非公開にしてインターフェイスを定義する (Sexp.t のように, 型の中身は分からない) ような流儀</li>
</ul>
<p>今後 OCaml が流行るのか廃れるのかは分かりませんが, 少なくとも新しい見方や考え方を得られるのは, 損得抜きに純粋に楽しいです.<br>
どれくらい OCaml に深入りするかは決めてませんが, 次はスネークゲームよりは大きいプログラムを作ろうと思っています.
+++
title = &ldquo;『Real World OCaml』で入門レベルを脱する&rdquo;
date = 2021-12-29
tags = [&ldquo;ocaml&rdquo;]
cover.image = &ldquo;<a href="https://source.unsplash.com/YAIGmqV4dFc%22">https://source.unsplash.com/YAIGmqV4dFc&quot;</a>
+++</p>
<p>本書は OCaml のベテランプログラマ 2 名による解説本です. 第 2 版が 2021 年にかかれていて, <a href="https://dev.realworldocaml.org/index.html">ネットで無料公開されています</a>.<br>
全 3 章は以下のような構成で, OCaml 初心者でも読めますし, 深堀りされた解説からは経験者でも得るものがありそうです.</p>
<ol>
<li>OCaml の機能一通り (基礎文法, ヴァリアント, レコード, ファンクター, GADT, Class など)</li>
<li>具体例 (コマンドラインの引数パーズ, 非同期通信, json パーザ)</li>
<li>OCaml のランタイムとコンパイラの仕組み</li>
</ol>
<p>個人的にここ数か月 OCaml に興味を持って少しずつ触れてきたのですが, 入門の次に進むための知識が得たいと思い本書を読みました. 知りたかったことは例えば以下のような点です.</p>
<ul>
<li>標準ライブラリにはそれほど機能が揃っていないが, 便利なライブラリがあるのか (または自分でライブラリを整備するのが普通なのか)</li>
<li>プロジェクトをどのようにファイル構成するか</li>
<li>どの程度の規模でモジュールを分けるか</li>
<li>テストはどうやって書くか</li>
</ul>
<p>こういった事柄はやや抽象的でそのものズバリ検索するのが難しいと思っていますが, 本書には知りたかったことは全て書いてありました. そのくらい網羅的で, もちろん知らなかったこと (知りたいとすら思わなかったこと) も満載でした.<br>
高度な機能や具体的なライブラリの使い方などは読んでもピンとこなかったり軽く読み飛ばしたりした箇所があるのですが, 今後必要になったときに改めて読み返そうと思うような内容でした.</p>
<h2 id="base-と-jane-street-1">Base と Jane Street<a hidden class="anchor" aria-hidden="true" href="#base-と-jane-street-1">#</a></h2>
<p>本書では一貫して <a href="https://github.com/janestreet/base">Base</a> というライブラリが使われています. Base は OCaml の標準ライブラリを置き換えるべく作られたライブラリで, 今やデファクトスタンダードとなっている (らしい. 少なくとも私はそのような印象を受けた)OSS です.</p>
<p>メインの開発元は <a href="https://www.janestreet.com">Jane Street</a> という企業です. OCaml 界隈では存在感のある会社で, 株やオプションなどの取引市場を提供する金融×Tech の会社です. 複雑な金融商品を取り扱うためにテクノロジーに注力していて, その競争力の源泉となっているのが OCaml だということのようです. おそらく OCaml を使っている会社としては最も有名だと思います.</p>
<p>標準ではないライブラリに常に依存するのは若干抵抗がありますが, 非常に便利なので使えるなら使ったほうが良いと思います.<br>
とはいえ, 実際にどの程度使われているのかはちゃんと調べていません. 歴戦の OCaml プログラマーは自作のライブラリを持っていると思うので, 不要だったりするのかもしれません.</p>
<h2 id="すべてがリストだとこんなにも便利-1">すべてがリストだとこんなにも便利<a hidden class="anchor" aria-hidden="true" href="#すべてがリストだとこんなにも便利-1">#</a></h2>
<p>本書で得た知識の中でも, 知っているのといないのとでは大違いだと思ったものにパイプ演算子 <code>|&gt;</code> があります. 演算子の定義は以下の通りです.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> <span style="color:#99d1db;font-weight:bold">(|&gt;)</span> x f <span style="color:#99d1db;font-weight:bold">=</span> f x
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>引数 関数</code> の順番を入れ替えて <code>関数 引数</code> とする演算子です. つまり, 以下の 2 つが同じになります.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> m1 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">;</span> 2<span style="color:#99d1db;font-weight:bold">;</span> 3<span style="color:#99d1db;font-weight:bold">]</span> <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">*</span> 2<span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#737994;font-style:italic">(* [2; 4; 6] *)</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">let</span> m2 <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#99d1db;font-weight:bold">[</span>1<span style="color:#99d1db;font-weight:bold">;</span> 2<span style="color:#99d1db;font-weight:bold">;</span> 3<span style="color:#99d1db;font-weight:bold">]</span> <span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">*</span> 2<span style="color:#99d1db;font-weight:bold">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>これだけだと一体なんの役に立つのかさっぱりですが, 例を見ると納得です. 0-99 の中から, 13 の倍数を抽出し, 7 で割ったあまりが大きい順に表示する例です (この例自体には特に意味はありません).</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">open</span> <span style="color:#e5c890">Base</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ef9f76">List</span>.range 0 100
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.filter <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 13 <span style="color:#99d1db;font-weight:bold">=</span> 0<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.map <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 7<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.sort <span style="color:#99d1db;font-weight:bold">~</span>compare<span style="color:#99d1db;font-weight:bold">:</span><span style="color:#ef9f76">Int</span>.compare
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">|&gt;</span> <span style="color:#ef9f76">List</span>.rev <span style="color:#737994;font-style:italic">(* = reverse *)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>この例のように, リストに対する処理をパイプで連鎖させることができます. ネストが深くならないので見やすいですし, あとから行やコメントを追加することも容易いです.<br>
もし同じことをパイプ演算子なしでやると, 以下のようになります. あまりにも見辛いです.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ef9f76">List</span>.rev
</span></span><span style="display:flex;"><span>  <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.sort <span style="color:#99d1db;font-weight:bold">~</span>compare<span style="color:#99d1db;font-weight:bold">:</span><span style="color:#ef9f76">Int</span>.compare
</span></span><span style="display:flex;"><span>     <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.map
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 7<span style="color:#99d1db;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.filter <span style="color:#99d1db;font-weight:bold">~</span>f<span style="color:#99d1db;font-weight:bold">:(</span><span style="color:#ca9ee6">fun</span> x <span style="color:#99d1db;font-weight:bold">-&gt;</span> x <span style="color:#99d1db;font-weight:bold">%</span> 13 <span style="color:#99d1db;font-weight:bold">=</span> 0<span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#ef9f76">List</span>.range 0 100<span style="color:#99d1db;font-weight:bold">))))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>このパイプ演算子は Unix のパイプ (テキストを連鎖させる) や C# の Linq(IEnumerable を連鎖させる) と似ていると感じます. データ構造を統一するとこういう利点があると気付かされました.</p>
<h2 id="ocaml-のエコシステム-1">OCaml のエコシステム<a hidden class="anchor" aria-hidden="true" href="#ocaml-のエコシステム-1">#</a></h2>
<p>dune というビルドシステム (Rust の Cargo のようなもの. C/C++ の make の強化版), opam というパッケージマネージャ (gem, pip, npm のようなもの) があります.<br>
モダンな言語には標準装備されているような気がしますが, やはりあると安心です.</p>
<p>ちなみに dune の設定ファイルには S 式を使います. さらに, デバッグなどのシリアライズ用にも S 式を使います.<br>
json や XML ではなくて S 式を使うのは関数型っぽくて良いと思います. S 式は関数型世界の共通言語なのでしょうか.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">-</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#ef9f76">Sexp</span>.t <span style="color:#99d1db;font-weight:bold">=</span> 5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#99d1db;font-weight:bold">-</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e78284">string</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#a6d189">&#34;(1 2 3)&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="凄そうだけどピンとこない機能-1">凄そうだけどピンとこない機能<a hidden class="anchor" aria-hidden="true" href="#凄そうだけどピンとこない機能-1">#</a></h2>
<p>モジュール (Module) という便利な機能があります. これは, ある程度のコードをひとまとめにしてインターフェイスを定義できるもので, C++ だと Class のようなものです.</p>
<p>ファンクター(Functor) という, モジュールを引数にとってモジュールを返す関数のような機能があります. ごく簡単な例として, モジュールが持つ変数 x に 1 を足したモジュールを返すファンクターが紹介されています.</p>
<div class="highlight"><div style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#838ba7">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ocaml" data-lang="ocaml"><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Increment</span> <span style="color:#99d1db;font-weight:bold">(</span><span style="color:#e5c890">M</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e5c890">X_int</span><span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#99d1db;font-weight:bold">:</span> <span style="color:#e5c890">X_int</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">struct</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">let</span> x <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ef9f76">M</span>.x <span style="color:#99d1db;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Three</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#ca9ee6">struct</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">let</span> x <span style="color:#99d1db;font-weight:bold">=</span> 3
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">module</span> <span style="color:#e5c890">Four</span> <span style="color:#99d1db;font-weight:bold">=</span> <span style="color:#e5c890">Incremnt</span><span style="color:#99d1db;font-weight:bold">(</span><span style="color:#e5c890">Three</span><span style="color:#99d1db;font-weight:bold">)</span> <span style="color:#737994;font-style:italic">(* Four.x = 4 *)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>これは, 私にとって馴染みある C++ などの言語には相当するものがない機能だと思います. 強いて言うなら継承が近いでしょうか.<br>
その他に, 端点を表すモジュールを引数にとって区間を扱うモジュールを返す例が紹介されています. これは確かに凄いですが, しかし他の使いみちをパッと思い浮かびません.</p>
<p>今まで触れたことがない概念であり, 抽象度も一段高いので理解しづらいのかなと思います. 読むだけだとピンとこないので, 実際にコードを色々書いてみて必要になったときに初めて理解できそうな気がします.<br>
その他に, エラーハンドリングや Core.Async の非同期処理など, 読んですぐにはピンとこないものの必要になったときに再度参照したい項目がありました.</p>
<h2 id="実践ワークショップ-1">実践ワークショップ<a hidden class="anchor" aria-hidden="true" href="#実践ワークショップ-1">#</a></h2>
<p>本書とは別のものですが, Jane Street が提供している <a href="https://github.com/janestreet/learn-ocaml-workshop">learn-ocaml-workshop</a> というリポジトリがあります. OCaml の基礎文法を一通りテストできる演習問題がまとまっていておすすめです.</p>
<p>練習の一環としてスネークゲームを実装する課題がありました. 穴埋め形式でコードを書いてテストを通せば良いので取り組みやすかったのですが, ちゃんと分かった気がしなかったので, 改めて <a href="https://github.com/momorin256/rattlesnake">自作しました</a>.<br>
なるべく依存が少なくなるようにして, 端末で動くシンプルなものを作りました. 実装にあたって curses/ncurses の OCaml バインディング <a href="https://github.com/mbacarella/curses">curses</a> を使わせていただきました.<br>
スネークゲームのロジック自体はそこまで複雑ではありませんが, Core.Unix から低レベルな API を使った non-blocking キー入力や, Curses で未実装だった cbreak, noecho の実装が個人的な見どころです.</p>
<h2 id="結び-ocaml-の何に魅力を感じるか-1">結び: OCaml の何に魅力を感じるか<a hidden class="anchor" aria-hidden="true" href="#結び-ocaml-の何に魅力を感じるか-1">#</a></h2>
<p>正直なところ本書の内容を理解しきれておらず, 紹介できていない内容が多数あります (GADT など&hellip;). これらは今後 OCaml を使い続けていくうちに, いつか分かるときが来ると思っています. 再読して理解が深まったら加筆するかもしれません.</p>
<p>改めて, 何が面白くて OCaml に触れているのか考えてみると, C++ にはない概念や機能があるということが大きいと思います.</p>
<ul>
<li>ファンクター, ヴァリアントなどは C++ にはない</li>
<li>基本的にすべて immutable(C++ でもどうせほとんどの変数には const をつけるので, デフォルトが immutable な方が好き)</li>
<li>List が主要なデータ構造で, List を使った処理が上手く書ける</li>
<li>強力なパターンマッチ</li>
<li>モジュールに型を定義して, 型の実装を非公開にしてインターフェイスを定義する (Sexp.t のように, 型の中身は分からない) ような流儀</li>
</ul>
<p>今後 OCaml が流行るのか廃れるのかは分かりませんが, 少なくとも新しい見方や考え方を得られるのは, 損得抜きに純粋に楽しいです.<br>
どれくらい OCaml に深入りするかは決めてませんが, 次はスネークゲームよりは大きいプログラムを作ろうと思っています.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/ocaml/">Ocaml</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/interpreter-in-go/">
    <span class="title">« Prev</span>
    <br>
    <span>『Go 言語でつくるインタプリタ』を OCaml でやる</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/copl/">
    <span class="title">Next »</span>
    <br>
    <span>『プログラミング言語の基礎概念』で型推論を実装する</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on x"
            href="https://x.com/intent/tweet/?text=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f&amp;hashtags=ocaml">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f&amp;title=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b&amp;summary=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f&title=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on whatsapp"
            href="https://api.whatsapp.com/send?text=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on telegram"
            href="https://telegram.me/share/url?text=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share 『Real World OCaml』で入門レベルを脱する on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=%e3%80%8eReal%20World%20OCaml%e3%80%8f%e3%81%a7%e5%85%a5%e9%96%80%e3%83%ac%e3%83%99%e3%83%ab%e3%82%92%e8%84%b1%e3%81%99%e3%82%8b&u=http%3a%2f%2flocalhost%3a1313%2fposts%2freal-world-ocaml%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Momori Nakano</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
